<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Keuangan Yudi</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-5">
    <div class="max-w-2xl mx-auto bg-white p-6 rounded-2xl shadow-lg">
        <h1 class="text-2xl font-bold text-center text-slate-700 mb-6">Laporan Keuangan Nur Wahyudi</h1>

        <div class="grid grid-cols-2 gap-4 mb-8">
            <div class="bg-green-500 text-white p-4 rounded-xl text-center shadow">
                <p class="text-sm">Pemasukan</p>
                <p id="totalMasuk" class="text-xl font-bold">0</p>
            </div>
            <div class="bg-red-500 text-white p-4 rounded-xl text-center shadow">
                <p class="text-sm">Pengeluaran</p>
                <p id="totalKeluar" class="text-xl font-bold">0</p>
            </div>
        </div>

        <div class="mb-10">
            <canvas id="myChart"></canvas>
        </div>

        <div class="mt-8">
            <h2 class="text-lg font-bold text-slate-700 mb-4 border-b pb-2">Riwayat Transaksi Terakhir</h2>
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm border-collapse">
                    <thead>
                        <tr class="bg-slate-200 text-slate-700">
                            <th class="p-3 rounded-l-lg">Waktu</th>
                            <th class="p-3">Kategori</th>
                            <th class="p-3 rounded-r-lg">Keterangan</th>
                        </tr>
                    </thead>
                    <tbody id="tabelBody" class="divide-y">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                // Mengambil data dari data.json yang diupdate Replit
                const response = await fetch('data.json?t=' + new Date().getTime());
                const data = await response.json();

                const masuk = data.filter(d => d.tipe === 'PEMASUKAN').length;
                const keluar = data.filter(d => d.tipe === 'PENGELUARAN').length;

                document.getElementById('totalMasuk').innerText = masuk + " Transaksi";
                document.getElementById('totalKeluar').innerText = keluar + " Transaksi";

                // Render Tabel (10 transaksi terbaru)
                const tabelBody = document.getElementById('tabelBody');
                tabelBody.innerHTML = '';
                data.reverse().slice(0, 10).forEach(item => {
                    const colorClass = item.tipe === 'PEMASUKAN' ? 'text-green-600 font-bold' : 'text-red-600 font-bold';
                    const row = `
                        <tr class="hover:bg-gray-50 transition">
                            <td class="p-3 text-gray-500">${item.waktu}</td>
                            <td class="p-3 ${colorClass}">${item.tipe}</td>
                            <td class="p-3 text-slate-700">${item.pesan}</td>
                        </tr>
                    `;
                    tabelBody.innerHTML += row;
                });

                // Render Grafik
                const ctx = document.getElementById('myChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Pemasukan', 'Pengeluaran'],
                        datasets: [{
                            label: 'Jumlah Transaksi',
                            data: [masuk, keluar],
                            backgroundColor: ['#22c55e', '#ef4444'],
                            borderRadius: 10
                        }]
                    },
                    options: { responsive: true, scales: { y: { beginAtZero: true } } }
                });
            } catch (error) {
                console.error("Gagal memuat data:", error);
            }
        }
        loadData();
    </script>
</body>
</html>
